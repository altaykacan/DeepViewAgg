models:
    MM_ResUNet34_0_2_2_2_2:
        class: sparseconv3d.APIModel
        conv_type: "SPARSE"
        backend: "torchsparse"
        backbone:  # backbone offset specific for Sparse conv application builder
            define_constants:
                in_feat: 32
                image_in_feat: 4
                block: ResBlock # Can be any of the blocks in modules/MinkowskiEngine/api_modules.py

            down_conv:
                module_name: ResNetDown
                block: block
                N: [0, 0, 1, 1, 1, 1, 1, 1, 1, 1]
                down_conv_nn:
                    [
                        [FEAT, in_feat],
                        [in_feat, in_feat],

                        [in_feat, in_feat],
                        [in_feat, in_feat],

                        [in_feat, 2*in_feat],
                        [2*in_feat, 2*in_feat],

                        [2*in_feat, 4*in_feat],
                        [4*in_feat, 4*in_feat],

                        [4*in_feat, 8*in_feat],
                        [8*in_feat, 8*in_feat],
                    ]
                kernel_size: 3
                stride: [1, 1, 2, 1, 2, 1, 2, 1, 2, 1]

                image:
                    down_conv:
                        module_name: ResNetDown
                        block: ResBlock
                        N: [0, 2, 2, 2, 2]
                        down_conv_nn:
                            [
                                [ image_in_feat, in_feat ],
                                [ in_feat, in_feat ],
                                [ in_feat, 2*in_feat ],
                                [ 2*in_feat, 4*in_feat ],
                                [ 4*in_feat, 8*in_feat ],
                            ]
                        kernel_size: [3, 2, 2, 2, 2]
                        stride: [1, 2, 2, 2, 2]
                        padding: [1, 0, 0, 0, 0]
                    atomic_pooling:
                        module_name: BimodalCSRPool
                        mode: max
                    view_pooling:
                        module_name: BimodalCSRPool
                        mode: mean
                    fusion:
                        module_name: BimodalFusion
                        mode: residual
                    branching_index: [0, 1, 2, 3, 4]

            up_conv:
                block: block
                module_name: ResNetUp
                N: [1, 1, 1, 1, 1]
                up_conv_nn:
                    [
                        [8*in_feat, 4*in_feat],
                        [4*in_feat + 4*in_feat, 4*in_feat],
                        [4*in_feat + 2*in_feat, 3*in_feat],
                        [3*in_feat + in_feat, 3*in_feat],
                        [3*in_feat + in_feat, 3*in_feat],
                    ]
                kernel_size: 3
                stride: [2, 2, 2, 2, 1]
